---
layout: "post"
title: "Обзор&nbsp;медиасервера&nbsp;Kurento"
date: "2017-03-26 09:53"
permalink: /kurento-media-server-overview/
tags: [KMS, kurento, webrtc, media server, opensource]
keywords: "KMS, kurento, webrtc, media server, opensource"
author: vatrushkin
---
Kurento&nbsp;&mdash; это бесплатный [WebRTC](/webrtc-in-plain-russian) медиасервер с&nbsp;открытым исходным кодом. Он&nbsp;распределяет медиапотоки между пользователями, транскодирует видео, делает запись.

В&nbsp;предыдущих статьях мы&nbsp;рассматривали архитектуру групповых видеочатов. Решение с&nbsp;использованием медиасервера в&nbsp;таких случаях самое надежное, но&nbsp;значительно увеличивает накладные расходы на&nbsp;сервер.

![](/assets/posts/kurento-overview/Card_all.jpg)

Если мы&nbsp;делаем групповой чат без медиасервера, то&nbsp;вынуждены либо соединить каждого клиента с&nbsp;каждым, либо выбрать одного клиента и&nbsp;передавать поток через него.

Когда видео транслирует один клиент, например в&nbsp;приложение для проведения вебинаров, можно передавать потоки по&nbsp;цепочке между всеми клиентами ([Вебинар на&nbsp;WebRTC без медиасерверов](/chain-webrtc)).

Но&nbsp;у&nbsp;этих решений есть недостатки, которые станут критичными при большом числе подключенных клиентов.

<!--more-->
* Лишняя нагрузка на&nbsp;ресурсы и&nbsp;трафик клиента из-за дублирования исходящего потока.
* Низкое качество видео при большом количестве пользователей.
* Реализация записи на&nbsp;клиенте&nbsp;&mdash; более трудоемкая задача. Если мы&nbsp;хотим сохранить файл на&nbsp;сервере, пользователю придется ждать окончания его загрузки.

Медиасервер решает эти проблемы. Он&nbsp;управляет, маршрутизирует и&nbsp;записывает медиапотоки. С&nbsp;ним наше приложение будет работать быстрее у&nbsp;пользователей.

## Kurento и&nbsp;другие медиасервера ##

Существует несколько медиа серверов, которые поддерживают WebRTC.


#### <img src="/assets/posts/kurento-overview/wowza-logo-mini.png" style="display:inline-block; vertical-align: bottom;"/> Wowza Media Server ####

Wowza Media Server с&nbsp;2004 года используется вместе с&nbsp;Flash. Передача медиапотоков осуществляется по&nbsp;RTMP протоколу. Летом 2016 года у&nbsp;Wowza Media Server вышло обновление с&nbsp;поддержкой WebRTC. Новая версия находится в&nbsp;стадии beta-тестирования. Для использования Wowza Media Server без ограничений необходима платная лицензия.

#### <img src="/assets/posts/kurento-overview/jitsi-logo-mini.png" style="display:inline-block; vertical-align: bottom;"/> Jitsi Videobridge ####

Jitsi Videobridge является частью большого проекта Jitsi, который начал разрабатываться еще в&nbsp;2005&nbsp;году, как SIP-коммутатор. В&nbsp;2014 разработчики добавили поддержку WebRTC.

Jitsi Videobridge&nbsp;&mdash; это маршрутизатор WebRTC потоков. Он&nbsp;перенаправляет медиа потоки между участниками чата. Jitsi Videobridge обладает меньшей функциональностью по&nbsp;сравнению с&nbsp;медиасерверами. Решения на&nbsp;его основе требуют меньше системных ресурсов. В&nbsp;отличие от&nbsp;медиасерверов Jitsi Videobridge не&nbsp;умеет записывать, транскодировать или смешивать медиапотоки вместе.

#### <img src="/assets/posts/kurento-overview/kurento-logo-mini.png" style="display:inline-block; vertical-align: bottom;"/> Kurento Media Server ####

Kurento&nbsp;&mdash; это бесплатный WebRTC медиа сервер, который начал разрабатываться в&nbsp;мадридском университете Rey Juan Carlos в&nbsp;2010&nbsp;году. В&nbsp;его основе лежала простая идея&nbsp;&mdash; создать медиасервер с&nbsp;открытым исходным кодом, который будет состоять из&nbsp;подключаемых модулей, обрабатывающих медиа потоки, а&nbsp;также предоставить простое API разработчикам приложений.

За&nbsp;последний год Kurento скачали более 20&nbsp;000 раз и&nbsp;открыли на&nbsp;его основе более 200 проектов на&nbsp;GitHub. В&nbsp;сентябре 2016 года команды Twilio и&nbsp;Kurento объединились и&nbsp;теперь совместно работают над разработкой новой функциональности и&nbsp;повышением стабильности работы.


## Возможности ##

Kurento Media Server предоставляет следующий функционал из&nbsp;коробки:
![](/assets/posts/kurento-overview/Cloud.jpg)
Этот функционал обеспечивают встроенные модули.

![](/assets/posts/kurento-overview/API.jpg)

Разработчик может написать собственный модуль и&nbsp;подключить его к&nbsp;Kurento. Также в&nbsp;состав Kurento входит набор клиентских API для управления медиа сервером.

Kurento Media Server и&nbsp;его компоненты написаны на&nbsp;C/C++ и&nbsp;оптимизированы с&nbsp;точки зрения потребления ресурсов системы. Для фильтрации используются библиотеки Gstreamer или OpenCV. Один экземпляр Kurento Media Server (8&nbsp;ядер, 2.4&nbsp;ГГц, 16Гб RAM) может поддерживать порядка 1000 одновременных соединений пользователей.


## Как работать с&nbsp;Kurento ##

Основной идеей Kurento являются медиа элементы&nbsp;&mdash; это программные блоки, каждый из&nbsp;которых выполняет одну определенную функцию. Медиа элемент имеет вход и&nbsp;выход и&nbsp;выполняет операцию над фреймами видео или частями аудио.

Kurento содержит множество различных медиа элементов в&nbsp;комплекте. Например, медиа элемент WebRtcEndpoint используется для получения и&nbsp;отправления WebRTC медиа потоков, а&nbsp;медиа элемент RecorderEndpoint записывает все входящие медиа потоки в&nbsp;файловую систему.

#### Архитектура приложений Kurento ####

Архитектура приложений Kurento состоит из&nbsp;двух уровней:

![](/assets/posts/kurento-overview/Kurento_v2.jpg)

_Медиа уровень_ непосредственно передает данные медиа потоков и&nbsp;осуществляет кодирование/декодирование.

_Сигнальный уровень_ реализует бизнес-логику приложения&nbsp;&mdash; определяет, какие медиа элементы обрабатывают медиа потоки, управляет коммуникациями между компонентами системы и&nbsp;связывает клиента и&nbsp;Kurento.

#### Kurento API ####

Сигнальный уровень управляет медиасервером посредством Kurento API. Для Node.js и&nbsp;Java есть официальные SDK. Можно написать свое SDK под любую платформу, так как коммуникация между сигнальным уровнем и&nbsp;Kurento Media Server происходит через протокол Kurento, который основан на&nbsp;WebSockets и&nbsp;JSON-RPC. Например, мы&nbsp;можем управлять медиасервером напрямую и&nbsp;из&nbsp;браузера, но&nbsp;это не&nbsp;самое гибкое решение. С&nbsp;помощью отдельного сигнального сервера приложение масштабируется&nbsp;и, в&nbsp;зависимости от&nbsp;нагрузки, подключать пользователей к&nbsp;разным экземплярам Kurento Media Server. Этого не&nbsp;получилось&nbsp;бы при управлении медиасервером с&nbsp;клиента.

#### Медиа элементы ####

Разработка приложений с&nbsp;Kurento подобна игре в&nbsp;конструктор Lego&nbsp;&mdash; необходимо собрать из&nbsp;медиа элементов цепочку. Разработчик определяет, какие медиа элементы ему нужны, и&nbsp;собирает их&nbsp;в&nbsp;нужной последовательности. Соединяются элементы одинаково&nbsp;&mdash; у&nbsp;элемента-источника вызывается метод connect, а&nbsp;его аргументом является элемент, который нужно добавить в&nbsp;цепочку следующим:

```
sourceMediaElement.connect(sinkMediaElement)
```

#### Пример ####

Для начала работы нужно [установить медиа сервер](http://doc-kurento.readthedocs.io/en/stable/installation_guide.html). Создадим приложение, которое запишет WebRTC потоки на&nbsp;сервере. Для этого понадобится два медиа элемента: WebRtcEndpoint и&nbsp;RecorderEndpoint. При подключении пользователя, мы&nbsp;получим его медиапоток из&nbsp;WebRTCEndpoint и&nbsp;запишем в&nbsp;видеофайл на&nbsp;сервере с&nbsp;помощью RecorderEndpoint.

![](/assets/posts/kurento-overview/Primer.png)

Медиа элементы соединяем так:

```
WebRtcEndpoint.connect(RecorderEnpoint)
```

Возможности медиасервера не&nbsp;ограничены видеочатами или записью&nbsp;&mdash; можно передать по&nbsp;WebRTC на&nbsp;клиент видео с&nbsp;сетевой камеры или поток с&nbsp;SIP сервера для VoIP звонков. В&nbsp;документации Kurento много примеров на&nbsp;Node.js и&nbsp;Java, которые подойдут для более подробного изучения работы с&nbsp;медиасервером.

1. [Чат один-к-одному](http://doc-kurento.readthedocs.io/en/stable/tutorials.html#webrtc-one-to-one-video-call)
2. [Вебинар](http://doc-kurento.readthedocs.io/en/stable/tutorials.html#webrtc-one-to-many-broadcast)
3. [Групповой видеочат](http://doc-kurento.readthedocs.io/en/stable/tutorials.html#webrtc-many-to-many-video-call-group-call)


## Итоги ##

Kurento является решением для реализации сложных мультимедийных проектов в&nbsp;области видеотехнологий.

Kurento включает обширный набор инструментов для разработки и&nbsp;предоставляет разработчику возможность дополнять и&nbsp;расширять его.

После объединения с&nbsp;командой Twilio у&nbsp;Kurento появились большие перспективы развития в&nbsp;сторону гибкой облачной масштабируемой медиа системы.

Kurento является стабильной и&nbsp;зрелой технологией для создания приложений. Мы&nbsp;используем Kurento в&nbsp;нескольких наших проектах, один из&nbsp;которых&nbsp;&mdash; система для онлайн образования, призер DC&nbsp;Tech Day 2014&nbsp;&mdash; [BrainCert](https://www.braincert.com/).
